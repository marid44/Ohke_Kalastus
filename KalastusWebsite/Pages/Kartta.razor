@page "/kartta"
@inject IJSRuntime JSRuntime
@inject IConfiguration Configuration

<h3>Kalastus kartta</h3>
<div style="display:none;">
    <input type="checkbox" id="toggleRivers" checked @onchange="ToggleRivers" />
    <label for="toggleRivers">Map</label>
</div>
<div id="map" style="height: 80vh; width: 100%;"></div>


@code {
    private string apiKey;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            apiKey = Configuration["Maanmittauslaitos:ApiKey"]; // Ensure API key is set in appsettings.json
            await JSRuntime.InvokeVoidAsync("initializeMap", apiKey);

            // Automatically toggle the "Rivers" layer on
            await JSRuntime.InvokeVoidAsync("toggleLayer", "rivers", true);
        }
    }

    private async Task ToggleRivers(ChangeEventArgs e)
    {
        bool isChecked = (bool)e.Value;
        await JSRuntime.InvokeVoidAsync("toggleLayer", "rivers", isChecked);
    }
}

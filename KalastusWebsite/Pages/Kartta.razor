@page "/kartta"
@inject IJSRuntime JSRuntime
@inject IConfiguration Configuration

<h3>Fishing Map</h3>
<div>
    <input type="checkbox" id="toggleRivers" @onchange="ToggleRivers" />
    <label for="toggleRivers">Show Rivers</label>
    <input type="checkbox" id="toggleRoads" @onchange="ToggleRoads" />
    <label for="toggleRoads">Show Roads</label>
</div>
<div id="map" style="height: 500px; width: 100%;"></div>

@code {
    private string apiKey;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            apiKey = Configuration["Maanmittauslaitos:ApiKey"]; // Ensure API key is set in appsettings.json
            await JSRuntime.InvokeVoidAsync("initializeMap", apiKey);
        }
    }

    private async Task ToggleRivers(ChangeEventArgs e)
    {
        bool isChecked = (bool)e.Value;
        await JSRuntime.InvokeVoidAsync("toggleLayer", "rivers", isChecked);
    }

    private async Task ToggleRoads(ChangeEventArgs e)
    {
        bool isChecked = (bool)e.Value;
        await JSRuntime.InvokeVoidAsync("toggleLayer", "roads", isChecked);
    }
}
